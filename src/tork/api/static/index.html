<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tork Governance Playground</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#0f172a',
                            card: '#1e293b',
                            border: '#334155',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; }
        .tab-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
        textarea, input { background-color: #1e293b; border-color: #334155; }
        textarea:focus, input:focus { border-color: #3b82f6; outline: none; }
        pre { background-color: #1e293b; }
    </style>
</head>
<body class="min-h-screen text-gray-100">
    <div class="max-w-6xl mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">Tork Governance Playground</h1>
            <p class="text-gray-400">Interactive testing for policy evaluation, PII redaction, and security scanning</p>
        </header>

        <div class="mb-6 border-b border-dark-border">
            <nav class="flex space-x-8">
                <button onclick="switchTab('evaluate')" id="tab-evaluate" class="pb-3 px-1 font-medium tab-active">
                    Evaluate
                </button>
                <button onclick="switchTab('redact')" id="tab-redact" class="pb-3 px-1 font-medium text-gray-400 hover:text-gray-200">
                    Redact
                </button>
                <button onclick="switchTab('scan')" id="tab-scan" class="pb-3 px-1 font-medium text-gray-400 hover:text-gray-200">
                    Scan
                </button>
            </nav>
        </div>

        <div id="panel-evaluate" class="panel">
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium mb-2">Payload (JSON)</label>
                    <textarea id="evaluate-payload" rows="12" class="w-full p-4 rounded-lg border text-sm font-mono text-gray-100" placeholder='{"email": "user@example.com", "query": "SELECT * FROM users"}'>{
  "user": {
    "email": "john@example.com",
    "phone": "555-123-4567"
  },
  "query": "SELECT * FROM users",
  "api_key": "sk-proj-abc123xyz789"
}</textarea>
                    <div class="mt-3 flex items-center space-x-4">
                        <button onclick="evaluatePayload()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition">
                            Evaluate
                        </button>
                        <input id="evaluate-agent-id" type="text" placeholder="Agent ID (optional)" class="px-4 py-2 rounded-lg border text-sm flex-1">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Results</label>
                    <div id="evaluate-results" class="bg-dark-card rounded-lg border border-dark-border p-4 min-h-[300px]">
                        <p class="text-gray-500">Click "Evaluate" to see results</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-redact" class="panel hidden">
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium mb-2">Text to Redact</label>
                    <textarea id="redact-text" rows="8" class="w-full p-4 rounded-lg border text-sm text-gray-100" placeholder="Enter text containing PII...">Contact John at john.doe@company.com or call 555-123-4567.
His SSN is 123-45-6789 and credit card is 4111111111111111.
Server IP: 192.168.1.100
API Key: sk-proj-abc123xyz789def456</textarea>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium mb-2">PII Types to Detect</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="pii-email" checked class="rounded">
                                <span class="text-sm">Email</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="pii-phone" checked class="rounded">
                                <span class="text-sm">Phone</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="pii-ssn" checked class="rounded">
                                <span class="text-sm">SSN</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="pii-credit_card" checked class="rounded">
                                <span class="text-sm">Credit Card</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="pii-ip_address" checked class="rounded">
                                <span class="text-sm">IP Address</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="pii-api_key" checked class="rounded">
                                <span class="text-sm">API Key</span>
                            </label>
                        </div>
                    </div>
                    
                    <button onclick="redact()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition">
                        Redact
                    </button>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Results</label>
                    <div id="redact-results" class="bg-dark-card rounded-lg border border-dark-border p-4 min-h-[300px]">
                        <p class="text-gray-500">Click "Redact" to see results</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-scan" class="panel hidden">
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium mb-2">Configuration Content</label>
                    <textarea id="scan-content" rows="12" class="w-full p-4 rounded-lg border text-sm font-mono text-gray-100" placeholder="Paste configuration content...">{
  "server": {
    "host": "0.0.0.0",
    "port": 8080,
    "debug": true,
    "cors": {
      "allowed_origins": ["*"]
    }
  },
  "api_key": "sk-real-secret-key-12345",
  "database": {
    "password": "admin123"
  }
}</textarea>
                    <div class="mt-3 flex items-center space-x-4">
                        <button onclick="scan()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition">
                            Scan
                        </button>
                        <input id="scan-filename" type="text" value="config.json" placeholder="Filename" class="px-4 py-2 rounded-lg border text-sm w-40">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Findings</label>
                    <div id="scan-results" class="bg-dark-card rounded-lg border border-dark-border p-4 min-h-[300px] overflow-auto">
                        <p class="text-gray-500">Click "Scan" to see findings</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function switchTab(tab) {
            document.querySelectorAll('.panel').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('[id^="tab-"]').forEach(t => {
                t.classList.remove('tab-active');
                t.classList.add('text-gray-400');
            });
            
            document.getElementById('panel-' + tab).classList.remove('hidden');
            const activeTab = document.getElementById('tab-' + tab);
            activeTab.classList.add('tab-active');
            activeTab.classList.remove('text-gray-400');
        }

        async function evaluatePayload() {
            const resultsDiv = document.getElementById('evaluate-results');
            resultsDiv.innerHTML = '<p class="text-gray-400">Processing...</p>';
            
            let payload;
            try {
                payload = JSON.parse(document.getElementById('evaluate-payload').value);
            } catch (e) {
                resultsDiv.innerHTML = '<p class="text-red-400">Invalid JSON: ' + e.message + '</p>';
                return;
            }
            
            const agentId = document.getElementById('evaluate-agent-id').value || 'playground';
            
            try {
                const response = await fetch('/playground/evaluate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ payload, agent_id: agentId })
                });
                const data = await response.json();
                
                const decisionColor = data.decision === 'ALLOW' ? 'text-green-400' : 
                                     data.decision === 'DENY' ? 'text-red-400' : 'text-yellow-400';
                
                let html = `
                    <div class="mb-4">
                        <span class="text-gray-400">Decision:</span>
                        <span class="${decisionColor} font-bold ml-2">${data.decision}</span>
                        <span class="text-gray-500 text-sm ml-4">${data.processing_time_ms}ms</span>
                    </div>
                `;
                
                if (data.violations.length > 0) {
                    html += `<div class="mb-4">
                        <p class="text-gray-400 mb-2">Violations:</p>
                        <ul class="list-disc list-inside text-sm text-orange-400">
                            ${data.violations.map(v => '<li>' + v + '</li>').join('')}
                        </ul>
                    </div>`;
                }
                
                if (data.pii_found.length > 0) {
                    html += `<div class="mb-4">
                        <p class="text-gray-400 mb-2">PII Found:</p>
                        <div class="flex flex-wrap gap-2">
                            ${data.pii_found.map(p => '<span class="px-2 py-1 bg-purple-900 text-purple-200 rounded text-xs">' + p.type + '</span>').join('')}
                        </div>
                    </div>`;
                }
                
                html += `<div>
                    <p class="text-gray-400 mb-2">Modified Payload:</p>
                    <pre class="p-3 rounded text-xs overflow-auto max-h-40">${JSON.stringify(data.modified_payload, null, 2)}</pre>
                </div>`;
                
                resultsDiv.innerHTML = html;
            } catch (e) {
                resultsDiv.innerHTML = '<p class="text-red-400">Error: ' + e.message + '</p>';
            }
        }

        async function redact() {
            const resultsDiv = document.getElementById('redact-results');
            resultsDiv.innerHTML = '<p class="text-gray-400">Processing...</p>';
            
            const text = document.getElementById('redact-text').value;
            const piiTypes = [];
            
            ['email', 'phone', 'ssn', 'credit_card', 'ip_address', 'api_key'].forEach(type => {
                if (document.getElementById('pii-' + type).checked) {
                    piiTypes.push(type);
                }
            });
            
            try {
                const response = await fetch('/playground/redact', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, pii_types: piiTypes.length > 0 ? piiTypes : null })
                });
                const data = await response.json();
                
                let html = `
                    <div class="mb-4">
                        <span class="text-gray-400">Processing time:</span>
                        <span class="text-gray-200 ml-2">${data.processing_time_ms}ms</span>
                    </div>
                    <div class="mb-4">
                        <p class="text-gray-400 mb-2">Original:</p>
                        <pre class="p-3 rounded text-xs whitespace-pre-wrap">${escapeHtml(data.original)}</pre>
                    </div>
                    <div class="mb-4">
                        <p class="text-gray-400 mb-2">Redacted:</p>
                        <pre class="p-3 rounded text-xs whitespace-pre-wrap text-green-300">${escapeHtml(data.redacted)}</pre>
                    </div>
                `;
                
                if (data.matches.length > 0) {
                    html += `<div>
                        <p class="text-gray-400 mb-2">Matches (${data.matches.length}):</p>
                        <div class="space-y-1">
                            ${data.matches.map(m => `
                                <div class="flex items-center text-sm">
                                    <span class="px-2 py-1 bg-purple-900 text-purple-200 rounded text-xs mr-2">${m.type}</span>
                                    <code class="text-gray-400">${escapeHtml(m.text)}</code>
                                </div>
                            `).join('')}
                        </div>
                    </div>`;
                }
                
                resultsDiv.innerHTML = html;
            } catch (e) {
                resultsDiv.innerHTML = '<p class="text-red-400">Error: ' + e.message + '</p>';
            }
        }

        async function scan() {
            const resultsDiv = document.getElementById('scan-results');
            resultsDiv.innerHTML = '<p class="text-gray-400">Scanning...</p>';
            
            const content = document.getElementById('scan-content').value;
            const filename = document.getElementById('scan-filename').value || 'config.json';
            
            try {
                const response = await fetch('/playground/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content, filename })
                });
                const data = await response.json();
                
                const severityColors = {
                    critical: 'bg-red-900 text-red-200',
                    high: 'bg-orange-900 text-orange-200',
                    medium: 'bg-yellow-900 text-yellow-200',
                    low: 'bg-blue-900 text-blue-200',
                    info: 'bg-gray-700 text-gray-200'
                };
                
                let html = `
                    <div class="mb-4 flex items-center justify-between">
                        <span class="text-gray-200">${data.summary.total} findings</span>
                        <span class="text-gray-500 text-sm">${data.processing_time_ms}ms</span>
                    </div>
                    <div class="mb-4 flex flex-wrap gap-2">
                        ${data.summary.critical > 0 ? '<span class="px-2 py-1 bg-red-900 text-red-200 rounded text-xs">' + data.summary.critical + ' Critical</span>' : ''}
                        ${data.summary.high > 0 ? '<span class="px-2 py-1 bg-orange-900 text-orange-200 rounded text-xs">' + data.summary.high + ' High</span>' : ''}
                        ${data.summary.medium > 0 ? '<span class="px-2 py-1 bg-yellow-900 text-yellow-200 rounded text-xs">' + data.summary.medium + ' Medium</span>' : ''}
                        ${data.summary.low > 0 ? '<span class="px-2 py-1 bg-blue-900 text-blue-200 rounded text-xs">' + data.summary.low + ' Low</span>' : ''}
                        ${data.summary.info > 0 ? '<span class="px-2 py-1 bg-gray-700 text-gray-200 rounded text-xs">' + data.summary.info + ' Info</span>' : ''}
                    </div>
                `;
                
                if (data.findings.length > 0) {
                    html += '<div class="space-y-2">';
                    data.findings.forEach(f => {
                        const colorClass = severityColors[f.severity] || severityColors.info;
                        html += `
                            <div class="p-3 bg-dark-bg rounded border border-dark-border">
                                <div class="flex items-start justify-between mb-1">
                                    <span class="px-2 py-0.5 ${colorClass} rounded text-xs font-medium">${f.severity.toUpperCase()}</span>
                                    <span class="text-gray-500 text-xs">${f.rule_id}</span>
                                </div>
                                <p class="text-sm text-gray-200">${escapeHtml(f.message)}</p>
                                ${f.line_number ? '<p class="text-xs text-gray-500 mt-1">Line ' + f.line_number + '</p>' : ''}
                            </div>
                        `;
                    });
                    html += '</div>';
                } else {
                    html += '<p class="text-green-400">No security issues found!</p>';
                }
                
                resultsDiv.innerHTML = html;
            } catch (e) {
                resultsDiv.innerHTML = '<p class="text-red-400">Error: ' + e.message + '</p>';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
